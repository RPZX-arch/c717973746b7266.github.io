var m=class{static library(){return"/library.json"}static settings(){return"/settings.json"}static game(t,e){return`/${t}/${e}`}static cheat(t,e){return`/${t}/${e}/${e}.cht`}static parse(t){let e=t.match(/\/([^\/]*)\/([^\/]*)/);return[e[1],e[2]]}static name(t){return t.substring(0,t.lastIndexOf("."))||t}static clean(t){return t.replaceAll(/ \(.*\)/g,"")}};var _=class{system;rom;name;installed;constructor(t,e,s){this.system=t.name,this.rom=e,this.installed=s,this.name=m.name(e)}};var x=class{name;enabled;order;value;static#t(){return 16}static serialize(t,e){let s=t.exports.calloc(e.length+1,this.#t()),r=new DataView(t.exports.memory.buffer,s),n=0;for(let a of e){let c=l.serialize(t,"string",a.name),u=l.serialize(t,"boolean",a.enabled),o=l.serialize(t,"number",a.order),h=l.serialize(t,"string",a.value);r.setUint32(n+0,c,!0),r.setUint32(n+4,u,!0),r.setUint32(n+8,o,!0),r.setUint32(n+12,h,!0),n+=this.#t()}return s}static free(t,e){let s=new DataView(t.exports.memory.buffer,e),r=0;for(;;){let n=s.getUint32(r+0,!0),a=s.getUint32(r+4,!0),c=s.getUint32(r+8,!0),u=s.getUint32(r+12,!0);if(!u)break;l.free(t,"string",n),l.free(t,"boolean",a),l.free(t,"number",c),l.free(t,"string",u),r+=this.#t()}return e}},R=class i{system;game;cheats;static fromGame(t,e){let s=new i;return s.system=t.name,s.game=e.name,s.cheats=[],s}static fromFile(t,e){let s=new i,[r,n]=m.parse(t);return s.system=r,s.game=n,s.cheats=e,s}};var y=class{key;value;name;options;static#t(){return 16}static parse(t,e){let s=new DataView(t.exports.memory.buffer,e),r=0,n=[];for(;;){let a=s.getUint32(r+0,!0),c=s.getUint32(r+4,!0),u=s.getUint32(r+8,!0),o=s.getUint32(r+12,!0);if(!a)break;n.push({key:l.deserialize(t,"string",a),value:l.deserialize(t,"string",c),name:l.deserialize(t,"string",u),options:l.deserialize(t,"string",o)?.split("|")}),r+=this.#t()}return n}static serialize(t,e){let s=t.exports.calloc(e.length+1,this.#t()),r=new DataView(t.exports.memory.buffer,s),n=0;for(let a of e){let c=l.serialize(t,"string",a.key),u=l.serialize(t,"string",a.value),o=l.serialize(t,"string",a.name),h=l.serialize(t,"string",a.options?.join("|"));r.setUint32(n+0,c,!0),r.setUint32(n+4,u,!0),r.setUint32(n+8,o,!0),r.setUint32(n+12,h,!0),n+=this.#t()}return s}static free(t,e){let s=new DataView(t.exports.memory.buffer,e),r=0;for(;;){let n=s.getUint32(r+0,!0),a=s.getUint32(r+4,!0),c=s.getUint32(r+8,!0),u=s.getUint32(r+12,!0);if(!n)break;l.free(t,"string",n),l.free(t,"string",a),l.free(t,"string",c),l.free(t,"string",u),r+=this.#t()}return e}};var D=class{data;format;width;height;pitch;ratio;static parse(t,e){let s=new DataView(t.buffer,e);return{data:s.getUint32(0,!0),format:s.getUint32(4,!0),width:s.getUint32(8,!0),height:s.getUint32(12,!0),pitch:s.getUint32(16,!0),ratio:s.getFloat32(20,!0)}}};var N=class{data;rate;frames;size;enable;static parse(t,e){let s=new DataView(t.buffer,e);return{data:s.getUint32(0,!0),rate:s.getFloat32(4,!0),frames:s.getUint32(8,!0),size:s.getUint32(12,!0),enable:s.getUint32(16,!0)}}};function P(i){return i["-ready-"]=()=>0,i["-port-"]=n=>(n.onmessage=onmessage,0),async n=>{let a=n.data.args.shift(),c=n.data.name,u=n.data.args,o=null;try{o=await i[c](...u)}catch(h){o=h}switch(typeof o){case"number":Atomics.store(a,1,1),Atomics.store(a,2,o);break;case"string":let h=new TextEncoder().encode(o);a.buffer.byteLength<12+h.byteLength&&a.buffer.grow(12+h.byteLength),Atomics.store(a,1,2),Atomics.store(a,2,h.byteLength),new Uint8Array(a.buffer).set(h,12);break;case"object":let f=o?.constructor.name.endsWith("Error"),d=JSON.stringify(f?o.stack:o),g=new TextEncoder().encode(d);a.buffer.byteLength<12+g.byteLength&&a.buffer.grow(12+g.byteLength),Atomics.store(a,1,f?4:3),Atomics.store(a,2,g.byteLength),new Uint8Array(a.buffer).set(g,12);break}Atomics.store(a,0,1),Atomics.notify(a,0,1)}}function k(i){switch(i[1]){case 1:return i[2];case 2:let n=new Uint8Array(i.buffer,12,i[2]).slice();return new TextDecoder().decode(n);case 3:let a=new Uint8Array(i.buffer,12,i[2]).slice();return JSON.parse(new TextDecoder().decode(a));case 4:let c=new Error,u=new Uint8Array(i.buffer,12,i[2]).slice();throw c.stack=JSON.parse(new TextDecoder().decode(u)),c}}var p=class{#t=null;#s=!1;#r=!1;#i=null;#e=null;#a=[];constructor(t,e,s){this.#t=t,this.#s=e,this.#r=s;let r=new this.#t;this.#i=new Proxy(r,{get:(n,a)=>{if(r[a]){let c=this;return function(){return c.#c(a,[...arguments],e)}}return Reflect.get(r,...arguments)}})}async create(t,e){e||(e=`onmessage = (${P})(new (${this.#t}));`);let s=new Blob([e],{type:"text/javascript"});return this.#e=new Worker(URL.createObjectURL(s),{name:t}),this.#e.onmessage=this.#r,await this.#c("-ready-",[],!1),this.#i}link(t){return this.#e=t,this.#e.onmessage=this.#r,this.#i}open(){let t=new MessageChannel;return this.#s?(this.#c("-port-",[t.port1]),t.port2):this.#c("-port-",[t.port1]).then(()=>t.port2)}close(){let t=this.#e;t.terminate&&t.terminate(),t.close&&t.close()}static instrument(t){let e=new MessageChannel;return e.port1.onmessage=P(t),e.port2}#n(t){let e=ArrayBuffer.isView(t)?t.buffer:t;return[MessagePort,OffscreenCanvas,ArrayBuffer].map(r=>r.name).includes(e?.constructor.name)?e:null}#c(t,e,s){e||(e=[]);let r=this.#a.length==0?new Int32Array(new SharedArrayBuffer(12,{maxByteLength:50*1024})):this.#a.pop().fill(0),n={name:t,args:[r,...e]},a=e.map(o=>this.#n(o)).filter(Boolean);this.#e.postMessage(n,a),s&&Atomics.wait(r,0,0);let c=s?{async:!1}:Atomics.waitAsync(r,0,0),u=()=>{let o=k(r);return this.#a.push(r),o};return c.async?c.value.then(()=>u()):u()}};var w=class i{static#t=1;static#s=[];static#r(t){t=`/${t}`.replace(/^\/+/,"/");let e=t.substring(t.lastIndexOf("/")+1),s=t.substring(1).indexOf("/")!=-1?t.substring(1,t.lastIndexOf("/")).split("/"):[];return{path:t,directories:s,filename:e}}static async#i(t,e){let s=await navigator.storage.getDirectory();for(let r of i.#r(t).directories)s=await s.getDirectoryHandle(r,{create:e});return s}static async#e(t,e){t||(t=await navigator.storage.getDirectory()),e||(e="");let s=[];for await(let r of t.values())r.kind=="file"&&s.push(`${e}/${r.name}`),r.kind=="directory"&&s.push(...await i.#e(r,`${e}/${r.name}`));return s}static async#a(t,e,s){let r=i.#r(t);if(!i.#s[r.path]){let a=await(await i.#i(r.path,e)).getFileHandle(r.filename,{create:e});i.#s[r.path]=await a.createSyncAccessHandle()}return s(i.#s[r.path])}static async#n(t,e){try{return await t()}catch(s){return console.error(s),e}}id(){return i.#t++}list(){return i.#n(()=>i.#e(),[])}size(t){return i.#n(()=>i.#a(t,!1,e=>e.getSize()),-1)}read(t,e,s){return i.#n(()=>i.#a(t,!1,r=>r.read(e,{at:s})),-1)}write(t,e,s){return i.#n(()=>i.#a(t,!0,r=>r.write(e,{at:s})),-1)}remove(t){return i.#n(async()=>(this.close(t),await(await i.#i(t)).removeEntry(i.#r(t).filename),0),-1)}close(t){return i.#n(()=>(t=i.#r(t).path,i.#s[t]&&(i.#s[t].flush(),i.#s[t].close(),delete i.#s[t]),0),-1)}};var O=class{get variables(){return Object.keys(this).map(t=>({key:t,value:this[t]}))}constructor(t){if(t)for(let e of Object.keys(t))this[e]=t[e]}};var z=class{paths=[];system;game;constructor(t){this.paths.push(t);let[e,s]=m.parse(t);this.system=e,this.game=s}isMapped(t){let e=t.find(s=>s.name==this.system);return!e||!e.games?!1:e.games.find(s=>s.name==this.game)!=null}};var b=class i{static#t=null;static#s=new TextEncoder;static#r=new TextDecoder;static#i=null;static#e=null;static async#a(){return this.#e||(this.#i=new p(w,!1),this.#e=await this.#i.create("filesystem")),this.#e}static async clone(){return this.#i.open()}static async list(){return await(await this.#a()).list()}static async read(t){let e=await this.#a(),s=await e.size(t);if(s<0)return null;let r=new Uint8Array(new SharedArrayBuffer(s));return await e.read(t,r,0),r.slice()}static async read_json(t){let e=await i.read(t);if(!e)return null;try{return JSON.parse(this.#r.decode(e))}catch(s){return console.error(s),null}}static async write(t,e){let s=await this.#a();await i.remove(t),await s.write(t,e,0)}static async write_json(t,e){let s=this.#s.encode(JSON.stringify(e));await i.write(t,s)}static async remove(t){await(await this.#a()).remove(t)}static Library=class{static async get(){i.#t||(i.#t=await fetch("cores.json").then(s=>s.json()));let t=await i.read_json(m.library())??[],e=[];for(let s of Object.keys(i.#t))for(let r of i.#t[s].systems){let n=t.find(a=>a.name==r)?.games??[];e.push({name:r,lib_name:s,core_name:i.#t[s].name,games:n.map(a=>new _(r,a.rom,!1))})}return e}static async update(t){await i.write_json(m.library(),t)}};static Settings=class{static async get(){return new O(await i.read_json(m.settings()))}static async update(t){await i.write_json(m.settings(),t)}};static Saves=class{static async get(){return(await i.list()).filter(e=>e.split("/").length==4).map(e=>new z(e)).reduce((e,s)=>{let r=e.find(n=>n.system==s.system&&n.game==s.game);return r?r.paths.push(s.paths[0]):e.push(s),e},[])}static async fix(t,e,s){for(let r of t.paths){let n=r.replace(t.system,e.name).replaceAll(t.game,s.name),a=await i.read(r);await i.remove(r),await i.write(n,a)}}static async remove(t){for(let e of t.paths)await i.remove(e)}};static Cheats=class{static async get(){let t=(await i.list()).filter(s=>s.endsWith(".cht")),e=[];for(let s of t){let r=await i.read_json(s);e.push(R.fromFile(s,r))}return e}static async update(t){await i.write_json(m.cheat(t.system,t.game),t.cheats)}static async remove(t){await i.remove(m.cheat(t.system,t.game))}};static Games=class{static async get(){let t=await i.Library.get(),e=(await i.list()).filter(r=>r.split("/").length==3),s=[];for(let r of e){let[n,a]=m.parse(r),c=t.find(u=>u.name==n);c&&s.push(new _(c,a,!0))}return s}static async add(t,e,s){await i.write(m.game(t,e),s)}static async remove(t,e){await i.remove(m.game(t,e))}}};var v=class{static#t={};static#s={};static#r=Promise.resolve();static#i(t){window.addEventListener("blur",()=>t.suspend()),window.addEventListener("focus",()=>setTimeout(()=>t.resume(),250));let e=()=>t.state=="suspended"&&t.resume();window.addEventListener("keydown",e),window.addEventListener("mousedown",e),window.addEventListener("touchstart",e)}static async#e(t,e){if(!this.#t[e]){let s=new AudioContext({sampleRate:e});await s.audioWorklet.addModule("audio-worker.js");let r=new AudioWorkletNode(s,"audio-processor",{outputChannelCount:[2]});r.connect(s.destination),this.#i(s),this.#t[e]=s,this.#s[e]=r}this.#s[e].port.postMessage(t,[t.buffer])}static queue(t,e){this.#r=this.#r.then(()=>this.#e(t,e))}};var I=()=>`
	attribute vec2 a_position;

	uniform vec2 u_resolution;
	uniform mat3 u_matrix;

	varying vec2 v_texCoord;

	void main() {
		gl_Position = vec4(u_matrix * vec3(a_position, 1), 1);
		v_texCoord = a_position;
	}
`,C=i=>`
	precision mediump float;

	uniform sampler2D u_image;

	varying vec2 v_texCoord;

	void main() {
		gl_FragColor = texture2D(u_image, v_texCoord);
		if (${i}) gl_FragColor = gl_FragColor.bgra;
	}
`,E=class{type=0;format=0;bpp=0;program=null;texture=null;position_buffer=null;position_location=0;matrix_location=0;constructor(t,e,s,r){this.type=e,this.format=s,this.bpp=r;let n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,I()),t.compileShader(n);let a=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(a,C(this.type!=t.UNSIGNED_SHORT_5_6_5)),t.compileShader(a),this.program=t.createProgram(),t.attachShader(this.program,n),t.attachShader(this.program,a),t.linkProgram(this.program),this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,this.format,0,0,0,this.format,this.type,null),this.position_location=t.getAttribLocation(this.program,"a_position"),this.matrix_location=t.getUniformLocation(this.program,"u_matrix"),this.position_buffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.position_buffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.STATIC_DRAW)}},A=class{#t=null;#s=[];constructor(t){this.#t=t.getContext("webgl2"),this.#s[0]=new E(this.#t,this.#t.UNSIGNED_SHORT_5_5_5_1,this.#t.RGBA,2),this.#s[1]=new E(this.#t,this.#t.UNSIGNED_BYTE,this.#t.RGBA,4),this.#s[2]=new E(this.#t,this.#t.UNSIGNED_SHORT_5_6_5,this.#t.RGB,2)}draw(t,e){let s=this.#s[e.format];this.#t.canvas.width=e.width,this.#t.canvas.height=e.width/e.ratio,this.#t.viewport(0,0,e.width,e.width/e.ratio),this.#t.useProgram(s.program),this.#t.bindBuffer(this.#t.ARRAY_BUFFER,s.position_buffer),this.#t.enableVertexAttribArray(s.position_location),this.#t.vertexAttribPointer(s.position_location,2,this.#t.FLOAT,!1,0,0),this.#t.bindTexture(this.#t.TEXTURE_2D,s.texture),this.#t.pixelStorei(this.#t.UNPACK_ROW_LENGTH,e.pitch/s.bpp),this.#t.texImage2D(this.#t.TEXTURE_2D,0,s.format,e.width,e.height,0,s.format,s.type,t),this.#t.generateMipmap(this.#t.TEXTURE_2D),this.#t.uniformMatrix3fv(s.matrix_location,!1,[2,0,0,0,-2,0,-1,1,1]),this.#t.drawArrays(this.#t.TRIANGLES,0,6)}};var T=class i{static#t=Promise.resolve();static#s=()=>{};#r=null;#i=null;#e=null;#a=null;#n=[];#c=null;#m=null;constructor(t,e){this.#a=t,this.#r=e}async create(t,e,s,r){await i.#t,i.#t=new Promise(o=>i.#s=o),this.#c=new A(s),this.#m=r;let n=location.origin+location.pathname.substring(0,location.pathname.lastIndexOf("/")),a={core:this.#a,system:t,rom:e,origin:n,memory:this.#r},c=await(await fetch("worker.js")).text(),u=async o=>{let h=new p(l,!1,u);await(await h.create(this.#a,c)).init(p.instrument(this),await b.clone(),{...a,...o.data}),this.#n.push(h)};this.#i=new p(l,!1,u),this.#e=await this.#i.create(this.#a,c),await this.#e.init(p.instrument(this),await b.clone(),a)}async start(t,e){await this.settings(t),await this.#e.start(),await this.cheats(e)}async stop(){try{await this.#e?.stop()}catch(t){console.error(t)}this.#n.forEach(t=>t.close()),this.#n=[],this.#i?.close(),this.#i=null,this.#e=null,new Uint8Array(this.#r.buffer).fill(0),i.#s()}draw(t){let e=t.format==1?new Uint8Array(this.#r.buffer,t.data,t.pitch*t.height):new Uint16Array(this.#r.buffer,t.data,t.pitch*t.height/2);this.#c.draw(e,t)}play(t){let e=new Int16Array(this.#r.buffer,t.data,t.frames*2);v.queue(e.slice(),t.rate)}variables(t){this.#m(t)}async settings(t){await this.#e?.variables(t.variables)}async cheats(t){await this.#e?.cheats(t)}async audio(t){await this.#e?.audio(t)}async speed(t){await this.#e?.speed(t)}async press(t,e){await this.#e?.press(t,e)}async touch(t,e,s,r){await this.#e?.touch(t,e,s,r)}async save(){await this.#e?.save()}async restore(){await this.#e?.restore()}};var S=class{get#t(){return 0}get#s(){return 8}get#r(){return 28}get#i(){return 44}get#e(){return 0}get#a(){return 0}get#n(){return 1}get#c(){return 2}get#m(){return 9}#u=null;#h=null;#p=0;#y=new Int32Array(new SharedArrayBuffer(4));#w=3;#o=[{path:"stdin",offset:0},{path:"stdout",offset:0},{path:"stderr",offset:0}];get fds(){return this.#o}constructor(t,e,s){this.#u=t,this.#h=e,this.#o={...this.#o,...s??[]}}#l(t){return new DataView(this.#u.buffer).getUint32(t,!0)}#f(t,e){new DataView(this.#u.buffer).setUint32(t,e,!0)}#b(t){return new DataView(this.#u.buffer).getBigUint64(t,!0)}#d(t,e){new DataView(this.#u.buffer).setBigUint64(t,BigInt(e),!0)}#g(t){let e=new Uint8Array(this.#u.buffer,t),s=0;for(;e[s]!=0;s++);return new TextDecoder().decode(e.slice(0,s))}#_(t,e){let s=new TextEncoder().encode(e);new Uint8Array(this.#u.buffer,t).set([...s,0])}get environment(){return{clock_time_get:(t,e,s)=>{let r=performance.timeOrigin+performance.now();return this.#d(s,Math.round(r*1e3*1e3)),this.#t},environ_get:(t,e)=>this.#t,environ_sizes_get:(t,e)=>this.#t,fd_close:t=>(delete this.#o[t],this.#t),fd_fdstat_get:(t,e)=>this.#t,fd_fdstat_set_flags:(t,e)=>this.#t,fd_filestat_set_size:(t,e)=>this.#t,fd_prestat_dir_name:(t,e,s)=>this.#p==t?(this.#_(e,"/"),this.#t):this.#r,fd_prestat_get:(t,e)=>this.#p==0?(this.#f(e,0),this.#d(e+4,1),this.#p=t,this.#t):this.#s,fd_readdir:(t,e,s,r,n)=>this.#t,fd_seek:(t,e,s,r)=>{if(t<3)return this.#t;let n=this.#h.size(this.#o[t].path);if(n==-1)return this.#i;switch(s){case this.#a:this.#o[t].offset=Number(e);break;case this.#n:this.#o[t].offset+=Number(e);break;case this.#c:this.#o[t].offset=n+Number(e);break}return this.#d(r,this.#o[t].offset),this.#t},fd_tell:(t,e)=>(this.#d(e,this.#o[t].offset),this.#t),fd_pread:(t,e,s,r,n)=>{if(t<3)return this.#s;let a=this.#h.size(this.#o[t].path);if(a==-1)return this.#i;let c=r;for(let u=0;u<s;u++){let o=e+u*8,h=this.#l(o),f=this.#l(o+4),d=f<a-r?f:a-r,g=new Uint8Array(this.#u.buffer,h,d);this.#h.read(this.#o[t].path,g,r),r+=d}return this.#f(n,r-c),this.#t},fd_read:(t,e,s,r)=>{let n=this.environment.fd_pread(t,e,s,this.#o[t].offset,r);return n==this.#t&&(this.#o[t].offset+=this.#l(r)),n},fd_pwrite:(t,e,s,r,n)=>{let a=new Uint8Array,c=t<3?(o,h)=>a=new Uint8Array([...a,...o]):(o,h)=>this.#h.write(this.#o[t].path,o,h),u=r;for(let o=0;o<s;o++){let h=e+o*8,f=this.#l(h),d=this.#l(h+4);c(new Uint8Array(this.#u.buffer,f,d),r),r+=d}switch(this.#f(n,r-u),t){case 1:let o=new TextDecoder().decode(a).trim();o&&console.log(o);break;case 2:let h=new TextDecoder().decode(a).trim();h&&console.error(h);break}return this.#t},fd_write:(t,e,s,r)=>{let n=this.environment.fd_pwrite(t,e,s,this.#o[t].offset,r);return n==this.#t&&t>2&&(this.#o[t].offset+=this.#l(r)),n},path_filestat_get:(t,e,s,r,n)=>this.#h.size(this.#g(s))==-1?this.#i:this.#t,path_open:(t,e,s,r,n,a,c,u,o)=>!(n&this.#m)&&this.#h.size(this.#g(s))==-1?this.#i:(this.#f(o,this.#w),this.#o[this.#w]={path:this.#g(s),offset:0},this.#w++,this.#t),poll_oneoff:(t,e,s,r)=>(this.#l(t+8)==this.#e&&Atomics.wait(this.#y,0,0,Number(this.#b(t+24))/1e6),this.#f(e+8,0),this.#t),proc_exit:t=>{throw`exit with exit code ${t}`},sched_yield:()=>this.#t}}};var U=class i{#t={};#s={};#r(t,e,s){let r=t.left+t.width/2,n=t.top+t.height/2,a=Math.max(Math.abs(e-r)-t.width/2,0),c=Math.max(Math.abs(s-n)-t.height/2,0);return Math.sqrt(Math.pow(a,2)+Math.pow(c,2))}press(t,e){let s=[],r=e.reduce((o,h)=>{let f=this.#r(h.rect,t.x,t.y);if(!o)return f<25?h:null;let d=this.#r(o.rect,t.x,t.y);return d>25&&f>25?null:f<d?h:o},null),n=this.#t[t.id];n&&n.id!=r?.id&&s.push({device:i.Device.JOYPAD,id:n.id,value:!1});let a=!!["mousedown","touchstart"].find(o=>o==t.type),c=!!["mousemove","touchmove"].find(o=>o==t.type),u=a||c&&n&&n.pressed;return r?.id?(s.push({device:i.Device.JOYPAD,id:r.id,value:u}),this.#t[t.id]={id:r?.id,pressed:u}):delete this.#t[t.id],s}touch(t,e,s,r){let n=(t.x-e.left)/(e.right-e.left)*s,a=(t.y-e.top)/(e.bottom-e.top)*r,c=!!["mousedown","touchstart"].find(h=>h==t.type),u=!!["mousemove","touchmove"].find(h=>h==t.type),o=c||u&&this.#s;return this.#s=o,[{device:i.Device.POINTER,id:i.Pointer.X,value:n},{device:i.Device.POINTER,id:i.Pointer.Y,value:a},{device:i.Device.POINTER,id:i.Pointer.PRESSED,value:o},{device:i.Device.POINTER,id:i.Pointer.COUNT,value:1}]}static Device=class{static get JOYPAD(){return 1}static get POINTER(){return 6}};static Joypad=class{static get B(){return 0}static get Y(){return 1}static get SELECT(){return 2}static get START(){return 3}static get UP(){return 4}static get DOWN(){return 5}static get LEFT(){return 6}static get RIGHT(){return 7}static get A(){return 8}static get X(){return 9}static get L(){return 10}static get R(){return 11}};static Pointer=class{static get X(){return 0}static get Y(){return 1}static get PRESSED(){return 2}static get COUNT(){return 3}}};var l=class i{static#t=new TextEncoder;static#s=new TextDecoder;#r=null;#i=null;#e=null;#a=new U;static serialize(t,e,s){if(e!="string"||s==null)return s;let r=t.exports.memory,n=t.exports.calloc(s.length+1,1);return new Uint8Array(r.buffer,n,s.length).set(this.#t.encode(s)),n}static deserialize(t,e,s){if(e!="string"||s==null)return s;let r=t.exports.memory,n=new Uint8Array(r.buffer,s),a=0;for(;n[a]!=0;a++);return n=new Uint8Array(r.buffer,s,a),this.#s.decode(new Uint8Array(n))}static free(t,e,s){e!="string"||s==null||t.exports.free(s)}#n(t,e,s){this[t]=(...r)=>{r=r.map((a,c)=>i.serialize(this.#e,s[c],a));let n=this.#e.exports[`Junie${t}`](...r);return r.forEach((a,c)=>i.free(this.#e,s[c],a)),i.deserialize(this.#e,e,n)}}async init(t,e,s){let r=new p(T,!0);this.#r=r.link(t);let a=new p(w,!0).link(e);this.#i=new S(s.memory,a,s.fds);let c=f=>{this.#r.draw(D.parse(s.memory,f))},u=f=>{this.#r.play(N.parse(s.memory,f))},o=f=>{this.#r.variables(y.parse(this.#e,f))},h=await WebAssembly.instantiateStreaming(fetch(`${s.origin}/modules/${s.core}.wasm`),{env:{memory:s.memory,web_video:c,web_audio:u,web_variables:o},wasi_snapshot_preview1:this.#i.environment,wasi:{"thread-spawn":f=>{let d=a.id();return postMessage({id:d,fds:this.#i.fds,start_arg:f}),d}}});if(this.#e=h.instance,s.start_arg)return this.#e.exports.wasi_thread_start(s.id,s.start_arg),close(),[];this.#e.exports._initialize(),this.#n("Create",null,["string","string"]),this.#n("StartGame","boolean",[]),this.#n("Destroy",null,[]),this.#n("SetAudio",null,["boolean"]),this.#n("SetSpeed",null,["number"]),this.#n("SetInput",null,["number","number","number"]),this.#n("SetVariables",null,["number"]),this.#n("SetCheats",null,["number"]),this.#n("SaveState",null,[]),this.#n("RestoreState",null,[]),this.Create(s.system,s.rom)}variables(t){let e=y.serialize(this.#e,t);this.SetVariables(e),y.free(this.#e,e)}cheats(t){let e=x.serialize(this.#e,t);this.SetCheats(e),x.free(this.#e,e)}press(t,e){for(let s of t)for(let r of this.#a.press(s,e))this.SetInput(r.device,r.id,r.value)}touch(t,e,s,r){for(let n of this.#a.touch(t,e,s,r))this.SetInput(n.device,n.id,n.value)}start(){this.StartGame()}stop(){this.Destroy()}audio(t){this.SetAudio(t)}speed(t){this.SetSpeed(t)}save(){this.SaveState()}restore(){this.RestoreState()}};onmessage=P(new l(self.name));
